# Cloud SQL コスト最適化検討結果

## 検討日

2025-12-16

## ポイント

- Cloud SQL (PostgreSQL 15) のコストが増えていたため、コスト削減の余地を検討した。
- 結果的には、サービス自体がやや高いだけだった。
- 常時起動のインスタンスがコストの大部分を占めている。
- HDD/SSD、バックアップ設定、代替サービスの観点で多少の削減は可能。
- ただし、既存インスタンスを HDD 化するには新規作成が必要で、データ移行の開発コストが高いため見送りした。

<br>

## コスト構造分析

### 現状のコスト内訳

- インスタンス: PostgreSQL 15, db-f1-micro
- リージョン: asia-northeast1
- ディスク: 10GB SSD（最小 10GB）
- バックアップ: 有効（7 日分保持、トランザクションログ 7 日分保持）

| 項目                         | 月額       | 割合     |
| ---------------------------- | ---------- | -------- |
| インスタンス料金（常時起動） | $7.67      | 75.4%    |
| SSD ストレージ（10GB）       | $1.70      | 16.7%    |
| バックアップ（7 日分）       | $0.80      | 7.9%     |
| **合計**                     | **$10.17** | **100%** |

<br>

## 検討したコスト削減案

### 1: On-Demand 設定（自動起動の停止）

- **結果**: PostgreSQL 第二世代は非対応
- **削減効果**: 実現不可

### 2: SSD → HDD 変更

- **削減効果**: 約$1.30/月（ディスクコストのみ 76%削減）
- **制約**: 既存インスタンスでは変更不可（新規作成が必要）
- **影響**: 記事数万件レベルでは体感差ほぼなし
- **判断**: 実装コスト（データ移行）に対して削減効果が小さい

将来的な選択肢としては良い。その場合は以下の手順で対応可能。

1. 新規インスタンスの作成
2. データ移行
3. 旧インスタンスの手動削除

### 3: バックアップ設定の最適化

- **変更内容**:
  - バックアップ保持期間: 7 日 → 1 日
  - トランザクションログ保持: 3 日 → 1 日
- **削減効果**: 約$0.80/月（バックアップコスト 100%削減）
- **リスク**: 低（1 日前には復元可能）
- **判断**: ✅ 採用

### 4: ディスク容量の削減

- **結果**: 10GB が最小容量（これ以上削減不可）
- **スケール**: むしろスケール化に対応させた。自動増加設定を有効化し、必要に応じて 20GB まで拡張可能に。

### 5: 代替サービス（Neon 等のサーバーレス DB）

- **削減効果**: 大（従量課金により$0-20/月）
- **移行コスト**: 高（アプリケーション改修、運用変更）
- **判断**: 将来的な選択肢として保留
